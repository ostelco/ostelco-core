plugins {
  id "org.jetbrains.kotlin.jvm" version "1.2.70"
  id 'java-library'
  id 'org.hidetake.swagger.generator' version '2.12.0'
  id "idea"
}

// gradle generateSwaggerCode
swaggerSources {

  // if they ever fix kotlin
//  'kotlin-client' {
//    inputFile = file("${projectDir}/../prime/infra/prod/prime-client-api.yaml")
//    code {
//      language = 'kotlin'
//      configFile = file("${projectDir}/config.json")
//    }
//  }
  'java-client' {
    inputFile = file("${projectDir}/../prime/infra/dev/prime-client-api.yaml")
    code {
      language = 'java'
      configFile = file("${projectDir}/config.json")
      // for creating only model
      // components = ["models"]
    }
  }
}

compileJava.dependsOn swaggerSources.'java-client'.code
sourceSets.main.java.srcDir "${swaggerSources.'java-client'.code.outputDir}/src/main/java"
sourceSets.main.resources.srcDir "${swaggerSources.'java-client'.code.outputDir}/src/main/resources"


dependencies {
  implementation "org.jetbrains.kotlin:kotlin-stdlib-jdk8:$kotlinVersion"
  swaggerCodegen 'io.swagger:swagger-codegen-cli:2.3.1'

  // taken from build/swagger-code-java-client/build.gradle
  // for model
  implementation 'io.swagger:swagger-annotations:1.5.15'
  implementation 'com.google.code.gson:gson:2.8.5'

  // for all
  implementation 'com.squareup.okhttp:okhttp:2.7.5'
  implementation 'com.squareup.okhttp:logging-interceptor:2.7.5'
  implementation 'io.gsonfire:gson-fire:1.8.3'
  implementation 'org.threeten:threetenbp:1.3.7'
  testImplementation 'junit:junit:4.12'
}

idea {
  module {
    // generatedSourceDirs
    sourceDirs += files("${project.buildDir.path}/swagger-code-java-client/src/main/java")
//    sourceDirs += files("${project.buildDir.path}/swagger-code-kotlin-client/src/main/kotlin")
  }
}