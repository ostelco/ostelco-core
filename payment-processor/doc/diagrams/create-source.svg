<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="591px" preserveAspectRatio="none" style="width:887px;height:591px;" version="1.1" viewBox="0 0 887 591" width="887px" zoomAndPan="magnify"><defs><filter height="300%" id="f1tsp9ldepck3l" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#DDDDDD" height="576.3203" style="stroke: #A80036; stroke-width: 1.0;" width="492" x="216.5" y="4"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="43" x="441" y="16.0669">Prime</text><rect fill="#FFFFFF" filter="url(#f1tsp9ldepck3l)" height="379.7266" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="26.5" y="96.2969"/><rect fill="#FFFFFF" filter="url(#f1tsp9ldepck3l)" height="258.1953" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="257.5" y="217.8281"/><rect fill="#FFFFFF" filter="url(#f1tsp9ldepck3l)" height="145.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="464.5" y="301.2266"/><rect fill="#FFFFFF" filter="url(#f1tsp9ldepck3l)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="674.5" y="330.3594"/><rect fill="#FFFFFF" filter="url(#f1tsp9ldepck3l)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="845.5" y="159.5625"/><rect fill="#FFFFFF" filter="url(#f1tsp9ldepck3l)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="845.5" y="388.625"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="31" x2="31" y1="86.2969" y2="494.0234"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="262.5" x2="262.5" y1="86.2969" y2="494.0234"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="469.5" x2="469.5" y1="86.2969" y2="494.0234"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="581.5" x2="581.5" y1="86.2969" y2="494.0234"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="679.5" x2="679.5" y1="86.2969" y2="494.0234"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="850.5" x2="850.5" y1="86.2969" y2="494.0234"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="41" x="8" y="82.9951">Client</text><ellipse cx="31.5" cy="13" fill="#FEFECE" filter="url(#f1tsp9ldepck3l)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M31.5,21 L31.5,48 M18.5,29 L44.5,29 M31.5,48 L18.5,63 M31.5,48 L44.5,63 " fill="none" filter="url(#f1tsp9ldepck3l)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="41" x="8" y="506.0186">Client</text><ellipse cx="31.5" cy="519.3203" fill="#FEFECE" filter="url(#f1tsp9ldepck3l)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M31.5,527.3203 L31.5,554.3203 M18.5,535.3203 L44.5,535.3203 M31.5,554.3203 L18.5,569.3203 M31.5,554.3203 L44.5,569.3203 " fill="none" filter="url(#f1tsp9ldepck3l)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f1tsp9ldepck3l)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="80" x="220.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="227.5" y="70.9951">client-api</text><rect fill="#FEFECE" filter="url(#f1tsp9ldepck3l)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="80" x="220.5" y="493.0234"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="227.5" y="513.0186">client-api</text><rect fill="#FEFECE" filter="url(#f1tsp9ldepck3l)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="152" x="391.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="138" x="398.5" y="70.9951">payment-processor</text><rect fill="#FEFECE" filter="url(#f1tsp9ldepck3l)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="152" x="391.5" y="493.0234"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="138" x="398.5" y="513.0186">payment-processor</text><rect fill="#FEFECE" filter="url(#f1tsp9ldepck3l)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="44" x="557.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="564.5" y="70.9951">OCS</text><rect fill="#FEFECE" filter="url(#f1tsp9ldepck3l)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="44" x="557.5" y="493.0234"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="564.5" y="513.0186">OCS</text><rect fill="#FEFECE" filter="url(#f1tsp9ldepck3l)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="46" x="654.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="661.5" y="70.9951">DAO</text><rect fill="#FEFECE" filter="url(#f1tsp9ldepck3l)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="46" x="654.5" y="493.0234"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="661.5" y="513.0186">DAO</text><rect fill="#FEFECE" filter="url(#f1tsp9ldepck3l)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="56" x="820.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="827.5" y="70.9951">Stripe</text><rect fill="#FEFECE" filter="url(#f1tsp9ldepck3l)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="56" x="820.5" y="493.0234"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="827.5" y="513.0186">Stripe</text><rect fill="#FFFFFF" filter="url(#f1tsp9ldepck3l)" height="379.7266" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="26.5" y="96.2969"/><rect fill="#FFFFFF" filter="url(#f1tsp9ldepck3l)" height="258.1953" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="257.5" y="217.8281"/><rect fill="#FFFFFF" filter="url(#f1tsp9ldepck3l)" height="145.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="464.5" y="301.2266"/><rect fill="#FFFFFF" filter="url(#f1tsp9ldepck3l)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="674.5" y="330.3594"/><rect fill="#FFFFFF" filter="url(#f1tsp9ldepck3l)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="845.5" y="159.5625"/><rect fill="#FFFFFF" filter="url(#f1tsp9ldepck3l)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="845.5" y="388.625"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="36.5" x2="78.5" y1="117.4297" y2="117.4297"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="78.5" x2="78.5" y1="117.4297" y2="130.4297"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="37.5" x2="78.5" y1="130.4297" y2="130.4297"/><polygon fill="#A80036" points="47.5,126.4297,37.5,130.4297,47.5,134.4297,43.5,130.4297" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="207" x="43.5" y="112.3638">Collecting payment information</text><polygon fill="#A80036" points="833.5,155.5625,843.5,159.5625,833.5,163.5625,837.5,159.5625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="36.5" x2="839.5" y1="159.5625" y2="159.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="195" x="43.5" y="154.4966">Create new source with Stripe</text><polygon fill="#A80036" points="47.5,184.6953,37.5,188.6953,47.5,192.6953,43.5,188.6953" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="41.5" x2="849.5" y1="188.6953" y2="188.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="71" x="53.5" y="183.6294">{sourceId}</text><polygon fill="#A80036" points="245.5,213.8281,255.5,217.8281,245.5,221.8281,249.5,217.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="36.5" x2="251.5" y1="217.8281" y2="217.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="43.5" y="212.7622">POST /sources {sourceId}</text><path d="M272,230.8281 L272,270.8281 L601,270.8281 L601,240.8281 L591,230.8281 L272,230.8281 " fill="#FBFB77" filter="url(#f1tsp9ldepck3l)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M591,230.8281 L591,240.8281 L601,240.8281 L591,230.8281 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="308" x="278" y="247.895">{name} identifies the user (from Oauth2 auth.)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="289" x="278" y="263.0278">and is equivalent to the users email address</text><polygon fill="#A80036" points="452.5,297.2266,462.5,301.2266,452.5,305.2266,456.5,301.2266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="267.5" x2="458.5" y1="301.2266" y2="301.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178" x="274.5" y="296.1606">addSource(name, sourceId)</text><polygon fill="#A80036" points="662.5,326.3594,672.5,330.3594,662.5,334.3594,666.5,330.3594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="474.5" x2="668.5" y1="330.3594" y2="330.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="481.5" y="325.2935">getStripeCustomerId(name)</text><polygon fill="#A80036" points="485.5,355.4922,475.5,359.4922,485.5,363.4922,481.5,359.4922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="479.5" x2="678.5" y1="359.4922" y2="359.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="491.5" y="354.4263">{customerId}</text><polygon fill="#A80036" points="833.5,384.625,843.5,388.625,833.5,392.625,837.5,388.625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="474.5" x2="839.5" y1="388.625" y2="388.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="352" x="481.5" y="383.5591">POST /v1/customers/{customerId}/sources {sourceId}</text><polygon fill="#A80036" points="485.5,413.7578,475.5,417.7578,485.5,421.7578,481.5,417.7578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="479.5" x2="849.5" y1="417.7578" y2="417.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="84" x="491.5" y="412.6919">{sourceInfo}</text><polygon fill="#A80036" points="278.5,442.8906,268.5,446.8906,278.5,450.8906,274.5,446.8906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="272.5" x2="468.5" y1="446.8906" y2="446.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="284.5" y="441.8247">{result}</text><polygon fill="#A80036" points="42.5,472.0234,32.5,476.0234,42.5,480.0234,38.5,476.0234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="36.5" x2="261.5" y1="476.0234" y2="476.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="48.5" y="470.9575">{result}</text><!--
@startuml

actor Client
participant Client

box "Prime"
    participant "client-api"
    participant "payment-processor"
    participant OCS
    participant DAO
end box
participant Stripe

activate Client
    Client -> Client : Collecting payment information

    Client -> Stripe : Create new source with Stripe
    activate Stripe
    Stripe -> Client : {sourceId}
    deactivate Stripe

    Client -> "client-api" : POST /sources {sourceId}
    activate  "client-api"
    note right of "client-api"
       {name} identifies the user (from Oauth2 auth.)
       and is equivalent to the users email address
    end note

    "client-api" -> "payment-processor" : addSource(name, sourceId)
    activate "payment-processor"

    "payment-processor" -> DAO : getStripeCustomerId(name)
    activate DAO
    DAO -> "payment-processor" : {customerId}
    deactivate DAO

    "payment-processor" -> Stripe : POST /v1/customers/{customerId}/sources {sourceId}
    activate Stripe
    Stripe -> "payment-processor" : {sourceInfo}
    deactivate Stripe

    "payment-processor" -> "client-api" : {result}
    deactivate "payment-processor"

    "client-api" -> Client : {result}
    deactivate "client-api"

deactivate Client

@enduml

PlantUML version 1.2018.08(Sun Jun 24 14:31:00 CEST 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_171-8u171-b11-0ubuntu0.17.10.1-b11
Operating System: Linux
OS Version: 4.13.0-46-generic
Default Encoding: UTF-8
Language: nb
Country: NO
--></g></svg>