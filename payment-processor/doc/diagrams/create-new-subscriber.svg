<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="587px" preserveAspectRatio="none" style="width:868px;height:587px;" version="1.1" viewBox="0 0 868 587" width="868px" zoomAndPan="magnify"><defs><filter height="300%" id="fcxql6wawtskl" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#DDDDDD" height="572.125" style="stroke: #A80036; stroke-width: 1.0;" width="482" x="61" y="4"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="43" x="280.5" y="16.0669">Prime</text><rect fill="#FFFFFF" filter="url(#fcxql6wawtskl)" height="239.1953" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="102" y="117.4297"/><rect fill="#FFFFFF" filter="url(#fcxql6wawtskl)" height="180.9297" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="338" y="117.4297"/><rect fill="#FFFFFF" filter="url(#fcxql6wawtskl)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="509" y="327.4922"/><rect fill="#FFFFFF" filter="url(#fcxql6wawtskl)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="811" y="240.0938"/><rect fill="#FFFFFF" filter="url(#fcxql6wawtskl)" height="271" style="stroke: #000000; stroke-width: 2.0;" width="801" x="55" y="201.8281"/><rect fill="#FFFFFF" height="53.9375" style="stroke: none; stroke-width: 1.0;" width="801" x="55" y="418.8906"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="31" x2="31" y1="86.2969" y2="489.8281"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="107" x2="107" y1="86.2969" y2="489.8281"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="343" x2="343" y1="86.2969" y2="489.8281"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="455" x2="455" y1="86.2969" y2="489.8281"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="514" x2="514" y1="86.2969" y2="489.8281"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="816" x2="816" y1="86.2969" y2="489.8281"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="41" x="8" y="82.9951">Client</text><ellipse cx="31.5" cy="13" fill="#FEFECE" filter="url(#fcxql6wawtskl)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M31.5,21 L31.5,48 M18.5,29 L44.5,29 M31.5,48 L18.5,63 M31.5,48 L44.5,63 " fill="none" filter="url(#fcxql6wawtskl)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="41" x="8" y="501.8232">Client</text><ellipse cx="31.5" cy="515.125" fill="#FEFECE" filter="url(#fcxql6wawtskl)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M31.5,523.125 L31.5,550.125 M18.5,531.125 L44.5,531.125 M31.5,550.125 L18.5,565.125 M31.5,550.125 L44.5,565.125 " fill="none" filter="url(#fcxql6wawtskl)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#fcxql6wawtskl)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="80" x="65" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="72" y="70.9951">client-api</text><rect fill="#FEFECE" filter="url(#fcxql6wawtskl)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="80" x="65" y="488.8281"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="72" y="508.8232">client-api</text><rect fill="#FEFECE" filter="url(#fcxql6wawtskl)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="152" x="265" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="138" x="272" y="70.9951">payment-processor</text><rect fill="#FEFECE" filter="url(#fcxql6wawtskl)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="152" x="265" y="488.8281"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="138" x="272" y="508.8232">payment-processor</text><rect fill="#FEFECE" filter="url(#fcxql6wawtskl)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="44" x="431" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="438" y="70.9951">OCS</text><rect fill="#FEFECE" filter="url(#fcxql6wawtskl)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="44" x="431" y="488.8281"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="438" y="508.8232">OCS</text><rect fill="#FEFECE" filter="url(#fcxql6wawtskl)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="46" x="489" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="496" y="70.9951">DAO</text><rect fill="#FEFECE" filter="url(#fcxql6wawtskl)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="46" x="489" y="488.8281"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="496" y="508.8232">DAO</text><rect fill="#FEFECE" filter="url(#fcxql6wawtskl)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="56" x="786" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="793" y="70.9951">Stripe</text><rect fill="#FEFECE" filter="url(#fcxql6wawtskl)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="56" x="786" y="488.8281"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="793" y="508.8232">Stripe</text><rect fill="#FFFFFF" filter="url(#fcxql6wawtskl)" height="239.1953" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="102" y="117.4297"/><rect fill="#FFFFFF" filter="url(#fcxql6wawtskl)" height="180.9297" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="338" y="117.4297"/><rect fill="#FFFFFF" filter="url(#fcxql6wawtskl)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="509" y="327.4922"/><rect fill="#FFFFFF" filter="url(#fcxql6wawtskl)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="811" y="240.0938"/><polygon fill="#A80036" points="326,113.4297,336,117.4297,326,121.4297,330,117.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="112" x2="332" y1="117.4297" y2="117.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212" x="119" y="112.3638">createPaymentProfile(customer)</text><path d="M117,130.4297 L117,185.4297 L537,185.4297 L537,140.4297 L527,130.4297 L117,130.4297 " fill="#FBFB77" filter="url(#fcxql6wawtskl)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M527,130.4297 L527,140.4297 L537,140.4297 L527,130.4297 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="399" x="123" y="147.4966">The {customer} object, obtained from OAuth2 authentication</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="371" x="123" y="162.6294">contains the information required for registering the user</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="298" x="123" y="177.7622">with a payment service (received from client)</text><path d="M55,201.8281 L119,201.8281 L119,208.8281 L109,218.8281 L55,218.8281 L55,201.8281 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="271" style="stroke: #000000; stroke-width: 2.0;" width="801" x="55" y="201.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="70" y="214.895">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="109" x="134" y="214.0386">[successful case]</text><polygon fill="#A80036" points="799,236.0938,809,240.0938,799,244.0938,803,240.0938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="348" x2="805" y1="240.0938" y2="240.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="444" x="355" y="235.0278">POST /v1/customers {customer} (Create new subscriber with Stripe)</text><polygon fill="#A80036" points="359,265.2266,349,269.2266,359,273.2266,355,269.2266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="353" x2="815" y1="269.2266" y2="269.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="365" y="264.1606">{customerId}</text><polygon fill="#A80036" points="123,294.3594,113,298.3594,123,302.3594,119,298.3594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="117" x2="342" y1="298.3594" y2="298.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="129" y="293.2935">{customerId}</text><polygon fill="#A80036" points="497,323.4922,507,327.4922,497,331.4922,501,327.4922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="112" x2="503" y1="327.4922" y2="327.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="211" x="119" y="322.4263">createProfile(name, customerId)</text><polygon fill="#A80036" points="118,352.625,108,356.625,118,360.625,114,356.625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="112" x2="513" y1="356.625" y2="356.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="124" y="351.5591">{result}</text><path d="M112,369.625 L112,409.625 L481,409.625 L481,379.625 L471,369.625 L112,369.625 " fill="#FBFB77" filter="url(#fcxql6wawtskl)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M471,369.625 L471,379.625 L481,379.625 L471,369.625 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="348" x="118" y="386.6919">The subscriber has now been registered with {name}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="311" x="118" y="401.8247">as the id and {customerId} as the id with Stripe</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="55" x2="856" y1="419.8906" y2="419.8906"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="40" x="60" y="430.1011">[error]</text><path d="M348,438.6953 L348,463.6953 L599,463.6953 L599,448.6953 L589,438.6953 L348,438.6953 " fill="#FBFB77" filter="url(#fcxql6wawtskl)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M589,438.6953 L589,448.6953 L599,448.6953 L589,438.6953 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="230" x="354" y="455.7622">Unroll charge with Stripe etc. (TBD)</text><!--
@startuml

actor Client
participant Client

box "Prime"
    participant "client-api"
    participant "payment-processor"
    participant OCS
    participant DAO
end box
participant Stripe

    "client-api" -> "payment-processor" : createPaymentProfile(customer)
    activate "client-api"
    activate "payment-processor"
    note right of "client-api"
        The {customer} object, obtained from OAuth2 authentication
        contains the information required for registering the user
        with a payment service (received from client)
    end note

    alt successful case
        "payment-processor" -> Stripe : POST /v1/customers {customer} (Create new subscriber with Stripe)
        activate Stripe
        "Stripe" -> "payment-processor" : {customerId}
        deactivate Stripe

        "payment-processor" -> "client-api" : {customerId}
        deactivate "payment-processor"

        "client-api" -> DAO : createProfile(name, customerId)
        activate DAO
        DAO -> "client-api" : {result}
        deactivate DAO
        deactivate "client-api"
        note right of "client-api"
            The subscriber has now been registered with {name}
            as the id and {customerId} as the id with Stripe
        end note

    else error
        note right of "payment-processor" : Unroll charge with Stripe etc. (TBD)

    end

@enduml

PlantUML version 1.2018.08(Sun Jun 24 14:31:00 CEST 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_171-8u171-b11-0ubuntu0.17.10.1-b11
Operating System: Linux
OS Version: 4.13.0-46-generic
Default Encoding: UTF-8
Language: nb
Country: NO
--></g></svg>