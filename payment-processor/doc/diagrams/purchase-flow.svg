<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="697px" preserveAspectRatio="none" style="width:830px;height:697px;" version="1.1" viewBox="0 0 830 697" width="830px" zoomAndPan="magnify"><defs><filter height="300%" id="foetc4p9atawi" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#DDDDDD" height="682.3242" style="stroke: #A80036; stroke-width: 1.0;" width="470.5" x="209" y="4"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="424.75" y="16.5684">Prime</text><rect fill="#FFFFFF" filter="url(#foetc4p9atawi)" height="485.3477" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="26" y="96.4883"/><rect fill="#FFFFFF" filter="url(#foetc4p9atawi)" height="363.1055" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="250" y="218.7305"/><rect fill="#FFFFFF" filter="url(#foetc4p9atawi)" height="57.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="348" y="436.5938"/><rect fill="#FFFFFF" filter="url(#foetc4p9atawi)" height="14" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="472" y="248.041"/><rect fill="#FFFFFF" filter="url(#foetc4p9atawi)" height="14" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="472" y="393.2832"/><rect fill="#FFFFFF" filter="url(#foetc4p9atawi)" height="14" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="472" y="465.9043"/><rect fill="#FFFFFF" filter="url(#foetc4p9atawi)" height="14" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="472" y="538.5254"/><rect fill="#FFFFFF" filter="url(#foetc4p9atawi)" height="72.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="594" y="291.3516"/><rect fill="#FFFFFF" filter="url(#foetc4p9atawi)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="789" y="160.1094"/><rect fill="#FFFFFF" filter="url(#foetc4p9atawi)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="789" y="320.6621"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="31" x2="31" y1="86.4883" y2="599.8359"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="255" x2="255" y1="86.4883" y2="599.8359"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="352.5" x2="352.5" y1="86.4883" y2="599.8359"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="476.5" x2="476.5" y1="86.4883" y2="599.8359"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="598.5" x2="598.5" y1="86.4883" y2="599.8359"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="794" x2="794" y1="86.4883" y2="599.8359"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="8" y="83.5352">Client</text><ellipse cx="31" cy="13" fill="#FEFECE" filter="url(#foetc4p9atawi)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M31,21 L31,48 M18,29 L44,29 M31,48 L18,63 M31,48 L44,63 " fill="none" filter="url(#foetc4p9atawi)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="8" y="612.3711">Client</text><ellipse cx="31" cy="625.3242" fill="#FEFECE" filter="url(#foetc4p9atawi)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M31,633.3242 L31,660.3242 M18,641.3242 L44,641.3242 M31,660.3242 L18,675.3242 M31,660.3242 L44,675.3242 " fill="none" filter="url(#foetc4p9atawi)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#foetc4p9atawi)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="80" x="213" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="220" y="71.5352">client-api</text><rect fill="#FEFECE" filter="url(#foetc4p9atawi)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="80" x="213" y="598.8359"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="220" y="619.3711">client-api</text><rect fill="#FEFECE" filter="url(#foetc4p9atawi)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="43" x="329.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="29" x="336.5" y="71.5352">OCS</text><rect fill="#FEFECE" filter="url(#foetc4p9atawi)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="43" x="329.5" y="598.8359"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="29" x="336.5" y="619.3711">OCS</text><rect fill="#FEFECE" filter="url(#foetc4p9atawi)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="67" x="441.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="53" x="448.5" y="71.5352">Storage</text><rect fill="#FEFECE" filter="url(#foetc4p9atawi)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="67" x="441.5" y="598.8359"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="53" x="448.5" y="619.3711">Storage</text><rect fill="#FEFECE" filter="url(#foetc4p9atawi)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="149" x="522.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="135" x="529.5" y="71.5352">payment-processor</text><rect fill="#FEFECE" filter="url(#foetc4p9atawi)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="149" x="522.5" y="598.8359"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="135" x="529.5" y="619.3711">payment-processor</text><rect fill="#FEFECE" filter="url(#foetc4p9atawi)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="54" x="765" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="772" y="71.5352">Stripe</text><rect fill="#FEFECE" filter="url(#foetc4p9atawi)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="54" x="765" y="598.8359"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="772" y="619.3711">Stripe</text><rect fill="#FFFFFF" filter="url(#foetc4p9atawi)" height="485.3477" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="26" y="96.4883"/><rect fill="#FFFFFF" filter="url(#foetc4p9atawi)" height="363.1055" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="250" y="218.7305"/><rect fill="#FFFFFF" filter="url(#foetc4p9atawi)" height="57.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="348" y="436.5938"/><rect fill="#FFFFFF" filter="url(#foetc4p9atawi)" height="14" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="472" y="248.041"/><rect fill="#FFFFFF" filter="url(#foetc4p9atawi)" height="14" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="472" y="393.2832"/><rect fill="#FFFFFF" filter="url(#foetc4p9atawi)" height="14" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="472" y="465.9043"/><rect fill="#FFFFFF" filter="url(#foetc4p9atawi)" height="14" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="472" y="538.5254"/><rect fill="#FFFFFF" filter="url(#foetc4p9atawi)" height="72.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="594" y="291.3516"/><rect fill="#FFFFFF" filter="url(#foetc4p9atawi)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="789" y="160.1094"/><rect fill="#FFFFFF" filter="url(#foetc4p9atawi)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="789" y="320.6621"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="36" x2="78" y1="117.7988" y2="117.7988"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="78" x2="78" y1="117.7988" y2="130.7988"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="37" x2="78" y1="130.7988" y2="130.7988"/><polygon fill="#A80036" points="47,126.7988,37,130.7988,47,134.7988,43,130.7988" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="200" x="43" y="113.0566">Collecting payment information</text><polygon fill="#A80036" points="777,156.1094,787,160.1094,777,164.1094,781,160.1094" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="36" x2="783" y1="160.1094" y2="160.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="43" y="155.3672">Checkout</text><polygon fill="#A80036" points="47,185.4199,37,189.4199,47,193.4199,43,189.4199" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="41" x2="793" y1="189.4199" y2="189.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="44" x="53" y="184.6777">{token}</text><polygon fill="#A80036" points="238,214.7305,248,218.7305,238,222.7305,242,218.7305" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="36" x2="244" y1="218.7305" y2="218.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="43" y="213.9883">POST /products {SKU, token}</text><polygon fill="#A80036" points="460,244.041,470,248.041,460,252.041,464,248.041" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="260" x2="466" y1="248.041" y2="248.041"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="267" y="243.2988">State { Purchase Initiated }</text><polygon fill="#A80036" points="271,258.041,261,262.041,271,266.041,267,262.041" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="265" x2="476" y1="262.041" y2="262.041"/><polygon fill="#A80036" points="582,287.3516,592,291.3516,582,295.3516,586,291.3516" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="260" x2="588" y1="291.3516" y2="291.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="267" y="286.6094">Perform payment</text><polygon fill="#A80036" points="777,316.6621,787,320.6621,777,324.6621,781,320.6621" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="604" x2="783" y1="320.6621" y2="320.6621"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="611" y="315.9199">Charge {token}</text><polygon fill="#A80036" points="615,345.9727,605,349.9727,615,353.9727,611,349.9727" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="609" x2="793" y1="349.9727" y2="349.9727"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="621" y="345.2305">Charge Object {id,result..}</text><polygon fill="#A80036" points="271,359.9727,261,363.9727,271,367.9727,267,363.9727" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="265" x2="598" y1="363.9727" y2="363.9727"/><polygon fill="#A80036" points="460,389.2832,470,393.2832,460,397.2832,464,393.2832" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="260" x2="466" y1="393.2832" y2="393.2832"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="267" y="388.541">State { Payment Completed }</text><polygon fill="#A80036" points="271,403.2832,261,407.2832,271,411.2832,267,407.2832" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="265" x2="476" y1="407.2832" y2="407.2832"/><polygon fill="#A80036" points="336,432.5938,346,436.5938,336,440.5938,340,436.5938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="260" x2="342" y1="436.5938" y2="436.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="69" x="267" y="431.8516">Notify OCS</text><polygon fill="#A80036" points="460,461.9043,470,465.9043,460,469.9043,464,465.9043" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="358" x2="466" y1="465.9043" y2="465.9043"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="365" y="461.1621">Update Balance</text><polygon fill="#A80036" points="369,475.9043,359,479.9043,369,483.9043,365,479.9043" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="363" x2="476" y1="479.9043" y2="479.9043"/><polygon fill="#A80036" points="271,489.9043,261,493.9043,271,497.9043,267,493.9043" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="265" x2="352" y1="493.9043" y2="493.9043"/><polygon fill="#A80036" points="460,534.5254,470,538.5254,460,542.5254,464,538.5254" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="260" x2="466" y1="538.5254" y2="538.5254"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="267" y="518.4727">State { Balance Updated }</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="267" y="533.7832">Save Purchase Record</text><polygon fill="#A80036" points="271,548.5254,261,552.5254,271,556.5254,267,552.5254" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="265" x2="476" y1="552.5254" y2="552.5254"/><polygon fill="#A80036" points="42,577.8359,32,581.8359,42,585.8359,38,581.8359" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="36" x2="254" y1="581.8359" y2="581.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="44" x="48" y="577.0938">{result}</text><!--
@startuml

actor Client
participant Client

box "Prime"
    participant "client-api"
    participant OCS
    participant Storage
    participant "payment-processor"
end box
participant Stripe

activate Client
  Client -> Client : Collecting payment information

  Client -> Stripe : Checkout
  activate Stripe
  Client <- - Stripe: {token}
  deactivate Stripe

  Client -> "client-api": POST /products {SKU, token}
  activate "client-api"

    "client-api" -> Storage : State { Purchase Initiated }
    activate Storage
    "client-api" <- - Storage
    deactivate Storage

    "client-api" -> "payment-processor" : Perform payment
    activate "payment-processor"

      "payment-processor" -> Stripe: Charge {token}
      activate Stripe
      "payment-processor" <- - Stripe : Charge Object {id,result..}
      deactivate Stripe

    "client-api" <- - "payment-processor"
    deactivate "payment-processor"

    "client-api" -> Storage : State { Payment Completed }
    activate Storage
    "client-api" <- - Storage
    deactivate Storage

    "client-api" -> OCS : Notify OCS
    activate OCS

        OCS -> Storage : Update Balance
        activate Storage
        OCS <- - Storage
        deactivate Storage

    "client-api" <- - OCS
    deactivate OCS

    "client-api" -> Storage : State { Balance Updated } \nSave Purchase Record
    activate Storage
    "client-api" <- - Storage
    deactivate Storage


  Client <- - "client-api": {result}
  deactivate "client-api"

deactivate Client

@enduml

PlantUML version 1.2018.05(Sat May 05 22:00:17 CEST 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 9+181
Operating System: Mac OS X
OS Version: 10.13.5
Default Encoding: UTF-8
Language: en
Country: NO
--></g></svg>