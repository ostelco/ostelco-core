<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="621px" preserveAspectRatio="none" style="width:836px;height:621px;" version="1.1" viewBox="0 0 836 621" width="836px" zoomAndPan="magnify"><defs><filter height="300%" id="falfy3jsrzif2" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#DDDDDD" height="606.6348" style="stroke: #A80036; stroke-width: 1.0;" width="470.5" x="215" y="4"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="39" x="430.75" y="16.5684">Prime</text><rect fill="#FFFFFF" filter="url(#falfy3jsrzif2)" height="485.3477" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="32" y="68.7988"/><rect fill="#FFFFFF" filter="url(#falfy3jsrzif2)" height="363.1055" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="256" y="191.041"/><rect fill="#FFFFFF" filter="url(#falfy3jsrzif2)" height="57.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="354" y="408.9043"/><rect fill="#FFFFFF" filter="url(#falfy3jsrzif2)" height="14" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="478" y="220.3516"/><rect fill="#FFFFFF" filter="url(#falfy3jsrzif2)" height="14" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="478" y="365.5938"/><rect fill="#FFFFFF" filter="url(#falfy3jsrzif2)" height="14" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="478" y="438.2148"/><rect fill="#FFFFFF" filter="url(#falfy3jsrzif2)" height="14" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="478" y="510.8359"/><rect fill="#FFFFFF" filter="url(#falfy3jsrzif2)" height="72.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="600" y="263.6621"/><rect fill="#FFFFFF" filter="url(#falfy3jsrzif2)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="795" y="132.4199"/><rect fill="#FFFFFF" filter="url(#falfy3jsrzif2)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="795" y="292.9727"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="37" x2="37" y1="58.7988" y2="572.1465"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="261" x2="261" y1="58.7988" y2="572.1465"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="358.5" x2="358.5" y1="58.7988" y2="572.1465"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="482.5" x2="482.5" y1="58.7988" y2="572.1465"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="604.5" x2="604.5" y1="58.7988" y2="572.1465"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="800" x2="800" y1="58.7988" y2="572.1465"/><rect fill="#FEFECE" filter="url(#falfy3jsrzif2)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="54" x="8" y="23.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="15" y="43.8457">Client</text><rect fill="#FEFECE" filter="url(#falfy3jsrzif2)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="54" x="8" y="571.1465"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="15" y="591.6816">Client</text><rect fill="#FEFECE" filter="url(#falfy3jsrzif2)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="80" x="219" y="23.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="226" y="43.8457">client-api</text><rect fill="#FEFECE" filter="url(#falfy3jsrzif2)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="80" x="219" y="571.1465"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="226" y="591.6816">client-api</text><rect fill="#FEFECE" filter="url(#falfy3jsrzif2)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="43" x="335.5" y="23.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="29" x="342.5" y="43.8457">OCS</text><rect fill="#FEFECE" filter="url(#falfy3jsrzif2)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="43" x="335.5" y="571.1465"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="29" x="342.5" y="591.6816">OCS</text><rect fill="#FEFECE" filter="url(#falfy3jsrzif2)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="67" x="447.5" y="23.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="53" x="454.5" y="43.8457">Storage</text><rect fill="#FEFECE" filter="url(#falfy3jsrzif2)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="67" x="447.5" y="571.1465"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="53" x="454.5" y="591.6816">Storage</text><rect fill="#FEFECE" filter="url(#falfy3jsrzif2)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="149" x="528.5" y="23.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="135" x="535.5" y="43.8457">payment-processor</text><rect fill="#FEFECE" filter="url(#falfy3jsrzif2)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="149" x="528.5" y="571.1465"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="135" x="535.5" y="591.6816">payment-processor</text><rect fill="#FEFECE" filter="url(#falfy3jsrzif2)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="54" x="771" y="23.3105"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="778" y="43.8457">Stripe</text><rect fill="#FEFECE" filter="url(#falfy3jsrzif2)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="54" x="771" y="571.1465"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="40" x="778" y="591.6816">Stripe</text><rect fill="#FFFFFF" filter="url(#falfy3jsrzif2)" height="485.3477" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="32" y="68.7988"/><rect fill="#FFFFFF" filter="url(#falfy3jsrzif2)" height="363.1055" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="256" y="191.041"/><rect fill="#FFFFFF" filter="url(#falfy3jsrzif2)" height="57.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="354" y="408.9043"/><rect fill="#FFFFFF" filter="url(#falfy3jsrzif2)" height="14" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="478" y="220.3516"/><rect fill="#FFFFFF" filter="url(#falfy3jsrzif2)" height="14" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="478" y="365.5938"/><rect fill="#FFFFFF" filter="url(#falfy3jsrzif2)" height="14" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="478" y="438.2148"/><rect fill="#FFFFFF" filter="url(#falfy3jsrzif2)" height="14" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="478" y="510.8359"/><rect fill="#FFFFFF" filter="url(#falfy3jsrzif2)" height="72.6211" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="600" y="263.6621"/><rect fill="#FFFFFF" filter="url(#falfy3jsrzif2)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="795" y="132.4199"/><rect fill="#FFFFFF" filter="url(#falfy3jsrzif2)" height="29.3105" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="795" y="292.9727"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="42" x2="84" y1="90.1094" y2="90.1094"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="84" x2="84" y1="90.1094" y2="103.1094"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="43" x2="84" y1="103.1094" y2="103.1094"/><polygon fill="#A80036" points="53,99.1094,43,103.1094,53,107.1094,49,103.1094" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="200" x="49" y="85.3672">Collecting payment information</text><polygon fill="#A80036" points="783,128.4199,793,132.4199,783,136.4199,787,132.4199" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="42" x2="789" y1="132.4199" y2="132.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="60" x="49" y="127.6777">Checkout</text><polygon fill="#A80036" points="53,157.7305,43,161.7305,53,165.7305,49,161.7305" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="47" x2="799" y1="161.7305" y2="161.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="44" x="59" y="156.9883">{token}</text><polygon fill="#A80036" points="244,187.041,254,191.041,244,195.041,248,191.041" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="42" x2="250" y1="191.041" y2="191.041"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="49" y="186.2988">POST /products {SKU, token}</text><polygon fill="#A80036" points="466,216.3516,476,220.3516,466,224.3516,470,220.3516" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="266" x2="472" y1="220.3516" y2="220.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="273" y="215.6094">State { Purchase Initiated }</text><polygon fill="#A80036" points="277,230.3516,267,234.3516,277,238.3516,273,234.3516" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="271" x2="482" y1="234.3516" y2="234.3516"/><polygon fill="#A80036" points="588,259.6621,598,263.6621,588,267.6621,592,263.6621" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="266" x2="594" y1="263.6621" y2="263.6621"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="273" y="258.9199">Perform payment</text><polygon fill="#A80036" points="783,288.9727,793,292.9727,783,296.9727,787,292.9727" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="610" x2="789" y1="292.9727" y2="292.9727"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="617" y="288.2305">Charge {token}</text><polygon fill="#A80036" points="621,318.2832,611,322.2832,621,326.2832,617,322.2832" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="615" x2="799" y1="322.2832" y2="322.2832"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="627" y="317.541">Charge Object {id,result..}</text><polygon fill="#A80036" points="277,332.2832,267,336.2832,277,340.2832,273,336.2832" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="271" x2="604" y1="336.2832" y2="336.2832"/><polygon fill="#A80036" points="466,361.5938,476,365.5938,466,369.5938,470,365.5938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="266" x2="472" y1="365.5938" y2="365.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="273" y="360.8516">State { Payment Completed }</text><polygon fill="#A80036" points="277,375.5938,267,379.5938,277,383.5938,273,379.5938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="271" x2="482" y1="379.5938" y2="379.5938"/><polygon fill="#A80036" points="342,404.9043,352,408.9043,342,412.9043,346,408.9043" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="266" x2="348" y1="408.9043" y2="408.9043"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="69" x="273" y="404.1621">Notify OCS</text><polygon fill="#A80036" points="466,434.2148,476,438.2148,466,442.2148,470,438.2148" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="364" x2="472" y1="438.2148" y2="438.2148"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="371" y="433.4727">Update Balance</text><polygon fill="#A80036" points="375,448.2148,365,452.2148,375,456.2148,371,452.2148" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="369" x2="482" y1="452.2148" y2="452.2148"/><polygon fill="#A80036" points="277,462.2148,267,466.2148,277,470.2148,273,466.2148" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="271" x2="358" y1="466.2148" y2="466.2148"/><polygon fill="#A80036" points="466,506.8359,476,510.8359,466,514.8359,470,510.8359" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="266" x2="472" y1="510.8359" y2="510.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="154" x="273" y="490.7832">State { Balance Updated }</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="273" y="506.0938">Save Purchase Record</text><polygon fill="#A80036" points="277,520.8359,267,524.8359,277,528.8359,273,524.8359" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="271" x2="482" y1="524.8359" y2="524.8359"/><polygon fill="#A80036" points="48,550.1465,38,554.1465,48,558.1465,44,554.1465" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="42" x2="260" y1="554.1465" y2="554.1465"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="44" x="54" y="549.4043">{result}</text><!--
@startuml
participant Client

box "Prime"
    participant "client-api"
    participant OCS
    participant Storage
    participant "payment-processor"
end box
participant Stripe

activate Client
  Client -> Client : Collecting payment information

  Client -> Stripe : Checkout
  activate Stripe
  Client <- - Stripe: {token}
  deactivate Stripe

  Client -> "client-api": POST /products {SKU, token}
  activate "client-api"

    "client-api" -> Storage : State { Purchase Initiated }
    activate Storage
    "client-api" <- - Storage
    deactivate Storage

    "client-api" -> "payment-processor" : Perform payment
    activate "payment-processor"

      "payment-processor" -> Stripe: Charge {token}
      activate Stripe
      "payment-processor" <- - Stripe : Charge Object {id,result..}
      deactivate Stripe

    "client-api" <- - "payment-processor"
    deactivate "payment-processor"

    "client-api" -> Storage : State { Payment Completed }
    activate Storage
    "client-api" <- - Storage
    deactivate Storage

    "client-api" -> OCS : Notify OCS
    activate OCS

        OCS -> Storage : Update Balance
        activate Storage
        OCS <- - Storage
        deactivate Storage

    "client-api" <- - OCS
    deactivate OCS

    "client-api" -> Storage : State { Balance Updated } \nSave Purchase Record
    activate Storage
    "client-api" <- - Storage
    deactivate Storage


  Client <- - "client-api": {result}
  deactivate "client-api"

deactivate Client

@enduml

PlantUML version 1.2018.05(Sat May 05 22:00:17 CEST 2018)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 9+181
Operating System: Mac OS X
OS Version: 10.13.5
Default Encoding: UTF-8
Language: en
Country: NO
--></g></svg>