<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="692px" preserveAspectRatio="none" style="width:777px;height:692px;" version="1.1" viewBox="0 0 777 692" width="777px" zoomAndPan="magnify"><defs><filter height="300%" id="f16u8gwu4nd5pc" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#DDDDDD" height="677.5234" style="stroke: #A80036; stroke-width: 1.0;" width="576" x="113.5" y="4"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="43" x="380" y="16.0669">Prime</text><rect fill="#FFFFFF" filter="url(#f16u8gwu4nd5pc)" height="480.9297" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="26.5" y="96.2969"/><rect fill="#FFFFFF" filter="url(#f16u8gwu4nd5pc)" height="459.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="154.5" y="117.4297"/><rect fill="#FFFFFF" filter="url(#f16u8gwu4nd5pc)" height="169.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="407.5" y="259.0938"/><rect fill="#FFFFFF" filter="url(#f16u8gwu4nd5pc)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="596.5" y="370.625"/><rect fill="#FFFFFF" filter="url(#f16u8gwu4nd5pc)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="655.5" y="200.8281"/><rect fill="#FFFFFF" filter="url(#f16u8gwu4nd5pc)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="655.5" y="518.9609"/><rect fill="#FFFFFF" filter="url(#f16u8gwu4nd5pc)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="720.5" y="312.3594"/><rect fill="#FFFFFF" filter="url(#f16u8gwu4nd5pc)" height="216.7344" style="stroke: #000000; stroke-width: 2.0;" width="658" x="107.5" y="274.0938"/><rect fill="#FFFFFF" height="53.9375" style="stroke: none; stroke-width: 1.0;" width="658" x="107.5" y="436.8906"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="31" x2="31" y1="86.2969" y2="595.2266"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="159.5" x2="159.5" y1="86.2969" y2="595.2266"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="412.5" x2="412.5" y1="86.2969" y2="595.2266"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="601.5" x2="601.5" y1="86.2969" y2="595.2266"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="660.5" x2="660.5" y1="86.2969" y2="595.2266"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="725.5" x2="725.5" y1="86.2969" y2="595.2266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="41" x="8" y="82.9951">Client</text><ellipse cx="31.5" cy="13" fill="#FEFECE" filter="url(#f16u8gwu4nd5pc)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M31.5,21 L31.5,48 M18.5,29 L44.5,29 M31.5,48 L18.5,63 M31.5,48 L44.5,63 " fill="none" filter="url(#f16u8gwu4nd5pc)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="41" x="8" y="607.2217">Client</text><ellipse cx="31.5" cy="620.5234" fill="#FEFECE" filter="url(#f16u8gwu4nd5pc)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M31.5,628.5234 L31.5,655.5234 M18.5,636.5234 L44.5,636.5234 M31.5,655.5234 L18.5,670.5234 M31.5,655.5234 L44.5,670.5234 " fill="none" filter="url(#f16u8gwu4nd5pc)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f16u8gwu4nd5pc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="80" x="117.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="124.5" y="70.9951">client-api</text><rect fill="#FEFECE" filter="url(#f16u8gwu4nd5pc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="80" x="117.5" y="594.2266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="124.5" y="614.2217">client-api</text><rect fill="#FEFECE" filter="url(#f16u8gwu4nd5pc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="152" x="334.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="138" x="341.5" y="70.9951">payment-processor</text><rect fill="#FEFECE" filter="url(#f16u8gwu4nd5pc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="152" x="334.5" y="594.2266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="138" x="341.5" y="614.2217">payment-processor</text><rect fill="#FEFECE" filter="url(#f16u8gwu4nd5pc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="44" x="577.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="584.5" y="70.9951">OCS</text><rect fill="#FEFECE" filter="url(#f16u8gwu4nd5pc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="44" x="577.5" y="594.2266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="584.5" y="614.2217">OCS</text><rect fill="#FEFECE" filter="url(#f16u8gwu4nd5pc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="46" x="635.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="642.5" y="70.9951">DAO</text><rect fill="#FEFECE" filter="url(#f16u8gwu4nd5pc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="46" x="635.5" y="594.2266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="642.5" y="614.2217">DAO</text><rect fill="#FEFECE" filter="url(#f16u8gwu4nd5pc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="56" x="695.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="702.5" y="70.9951">Stripe</text><rect fill="#FEFECE" filter="url(#f16u8gwu4nd5pc)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="56" x="695.5" y="594.2266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="702.5" y="614.2217">Stripe</text><rect fill="#FFFFFF" filter="url(#f16u8gwu4nd5pc)" height="480.9297" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="26.5" y="96.2969"/><rect fill="#FFFFFF" filter="url(#f16u8gwu4nd5pc)" height="459.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="154.5" y="117.4297"/><rect fill="#FFFFFF" filter="url(#f16u8gwu4nd5pc)" height="169.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="407.5" y="259.0938"/><rect fill="#FFFFFF" filter="url(#f16u8gwu4nd5pc)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="596.5" y="370.625"/><rect fill="#FFFFFF" filter="url(#f16u8gwu4nd5pc)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="655.5" y="200.8281"/><rect fill="#FFFFFF" filter="url(#f16u8gwu4nd5pc)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="655.5" y="518.9609"/><rect fill="#FFFFFF" filter="url(#f16u8gwu4nd5pc)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="720.5" y="312.3594"/><polygon fill="#A80036" points="142.5,113.4297,152.5,117.4297,142.5,121.4297,146.5,117.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="36.5" x2="148.5" y1="117.4297" y2="117.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="43.5" y="112.3638">DELETE /profile</text><path d="M169,130.4297 L169,170.4297 L498,170.4297 L498,140.4297 L488,130.4297 L169,130.4297 " fill="#FBFB77" filter="url(#f16u8gwu4nd5pc)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M488,130.4297 L488,140.4297 L498,140.4297 L488,130.4297 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="308" x="175" y="147.4966">{name} identifies the user (from Oauth2 auth.)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="289" x="175" y="162.6294">and is equivalent to the users email address</text><polygon fill="#A80036" points="643.5,196.8281,653.5,200.8281,643.5,204.8281,647.5,200.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="164.5" x2="649.5" y1="200.8281" y2="200.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="171.5" y="195.7622">getCustomerId(name)</text><polygon fill="#A80036" points="175.5,225.9609,165.5,229.9609,175.5,233.9609,171.5,229.9609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="169.5" x2="659.5" y1="229.9609" y2="229.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="181.5" y="224.895">{customerId}</text><polygon fill="#A80036" points="395.5,255.0938,405.5,259.0938,395.5,263.0938,399.5,259.0938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="164.5" x2="401.5" y1="259.0938" y2="259.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="171.5" y="254.0278">deletePaymentProfile(customerId)</text><path d="M107.5,274.0938 L171.5,274.0938 L171.5,281.0938 L161.5,291.0938 L107.5,291.0938 L107.5,274.0938 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="216.7344" style="stroke: #000000; stroke-width: 2.0;" width="658" x="107.5" y="274.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="122.5" y="287.1606">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="109" x="186.5" y="286.3042">[successful case]</text><polygon fill="#A80036" points="708.5,308.3594,718.5,312.3594,708.5,316.3594,712.5,312.3594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="417.5" x2="714.5" y1="312.3594" y2="312.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="238" x="424.5" y="307.2935">DELETE /v1/customers {customerId}</text><polygon fill="#A80036" points="428.5,337.4922,418.5,341.4922,428.5,345.4922,424.5,341.4922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="422.5" x2="724.5" y1="341.4922" y2="341.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="434.5" y="336.4263">{result}</text><polygon fill="#A80036" points="584.5,366.625,594.5,370.625,584.5,374.625,588.5,370.625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="417.5" x2="590.5" y1="370.625" y2="370.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="424.5" y="365.5591">clearBucket(customerId)</text><polygon fill="#A80036" points="428.5,395.7578,418.5,399.7578,428.5,403.7578,424.5,399.7578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="422.5" x2="600.5" y1="399.7578" y2="399.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="434.5" y="394.6919">{result}</text><polygon fill="#A80036" points="175.5,424.8906,165.5,428.8906,175.5,432.8906,171.5,428.8906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="169.5" x2="411.5" y1="428.8906" y2="428.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="181.5" y="423.8247">{result}</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="107.5" x2="765.5" y1="437.8906" y2="437.8906"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="40" x="112.5" y="448.1011">[error]</text><path d="M417,456.6953 L417,481.6953 L546,481.6953 L546,466.6953 L536,456.6953 L417,456.6953 " fill="#FBFB77" filter="url(#f16u8gwu4nd5pc)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M536,456.6953 L536,466.6953 L546,466.6953 L536,456.6953 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="423" y="473.7622">Unroll etc. (TBD)</text><polygon fill="#A80036" points="643.5,514.9609,653.5,518.9609,643.5,522.9609,647.5,518.9609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="164.5" x2="649.5" y1="518.9609" y2="518.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="171.5" y="513.895">deleteProfile(name)</text><polygon fill="#A80036" points="175.5,544.0938,165.5,548.0938,175.5,552.0938,171.5,548.0938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="169.5" x2="659.5" y1="548.0938" y2="548.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="181.5" y="543.0278">{result}</text><polygon fill="#A80036" points="42.5,573.2266,32.5,577.2266,42.5,581.2266,38.5,577.2266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="36.5" x2="158.5" y1="577.2266" y2="577.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="48.5" y="572.1606">{result}</text><!--
@startuml

actor Client
participant Client

box "Prime"
    participant "client-api"
    participant "payment-processor"
    participant OCS
    participant DAO
end box
participant Stripe

activate Client

    Client -> "client-api": DELETE /profile
    activate "client-api"
    note right of "client-api"
       {name} identifies the user (from Oauth2 auth.)
       and is equivalent to the users email address
    end note

    "client-api" -> DAO : getCustomerId(name)
    activate DAO
    DAO -> "client-api" : {customerId}
    deactivate DAO

    "client-api" -> "payment-processor" : deletePaymentProfile(customerId)
    activate "payment-processor"

    alt successful case
        "payment-processor" -> Stripe : DELETE /v1/customers {customerId}
        activate Stripe
        "Stripe" -> "payment-processor" : {result}
        deactivate Stripe

        "payment-processor" -> OCS : clearBucket(customerId)
        activate OCS
        OCS -> "payment-processor" : {result}
        deactivate OCS

        "payment-processor" -> "client-api" : {result}
        deactivate "payment-processor"

    else error
        note right of "payment-processor" : Unroll etc. (TBD)

    end

    "client-api" -> DAO : deleteProfile(name)
    activate DAO
    DAO -> "client-api" : {result}
    deactivate DAO

    "client-api" -> Client : {result}
    deactivate "client-api"

deactivate Client

@enduml

PlantUML version 1.2018.08(Sun Jun 24 14:31:00 CEST 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_171-8u171-b11-0ubuntu0.17.10.1-b11
Operating System: Linux
OS Version: 4.13.0-46-generic
Default Encoding: UTF-8
Language: nb
Country: NO
--></g></svg>