<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="750px" preserveAspectRatio="none" style="width:713px;height:750px;" version="1.1" viewBox="0 0 713 750" width="713px" zoomAndPan="magnify"><defs><filter height="300%" id="fyn65chsd2y5h" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#DDDDDD" height="735.7891" style="stroke: #A80036; stroke-width: 1.0;" width="512" x="113.5" y="4"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="43" x="348" y="16.0669">Prime</text><rect fill="#FFFFFF" filter="url(#fyn65chsd2y5h)" height="539.1953" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="26.5" y="96.2969"/><rect fill="#FFFFFF" filter="url(#fyn65chsd2y5h)" height="518.0625" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="154.5" y="117.4297"/><rect fill="#FFFFFF" filter="url(#fyn65chsd2y5h)" height="228.0625" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="346.5" y="259.0938"/><rect fill="#FFFFFF" filter="url(#fyn65chsd2y5h)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="532.5" y="428.8906"/><rect fill="#FFFFFF" filter="url(#fyn65chsd2y5h)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="591.5" y="200.8281"/><rect fill="#FFFFFF" filter="url(#fyn65chsd2y5h)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="591.5" y="288.2266"/><rect fill="#FFFFFF" filter="url(#fyn65chsd2y5h)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="591.5" y="577.2266"/><rect fill="#FFFFFF" filter="url(#fyn65chsd2y5h)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="656.5" y="370.625"/><rect fill="#FFFFFF" filter="url(#fyn65chsd2y5h)" height="216.7344" style="stroke: #000000; stroke-width: 2.0;" width="594" x="107.5" y="332.3594"/><rect fill="#FFFFFF" height="53.9375" style="stroke: none; stroke-width: 1.0;" width="594" x="107.5" y="495.1563"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="31" x2="31" y1="86.2969" y2="653.4922"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="159.5" x2="159.5" y1="86.2969" y2="653.4922"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="351.5" x2="351.5" y1="86.2969" y2="653.4922"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="537.5" x2="537.5" y1="86.2969" y2="653.4922"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="596.5" x2="596.5" y1="86.2969" y2="653.4922"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="661.5" x2="661.5" y1="86.2969" y2="653.4922"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="41" x="8" y="82.9951">Client</text><ellipse cx="31.5" cy="13" fill="#FEFECE" filter="url(#fyn65chsd2y5h)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M31.5,21 L31.5,48 M18.5,29 L44.5,29 M31.5,48 L18.5,63 M31.5,48 L44.5,63 " fill="none" filter="url(#fyn65chsd2y5h)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="41" x="8" y="665.4873">Client</text><ellipse cx="31.5" cy="678.7891" fill="#FEFECE" filter="url(#fyn65chsd2y5h)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M31.5,686.7891 L31.5,713.7891 M18.5,694.7891 L44.5,694.7891 M31.5,713.7891 L18.5,728.7891 M31.5,713.7891 L44.5,728.7891 " fill="none" filter="url(#fyn65chsd2y5h)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#fyn65chsd2y5h)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="80" x="117.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="124.5" y="70.9951">client-api</text><rect fill="#FEFECE" filter="url(#fyn65chsd2y5h)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="80" x="117.5" y="652.4922"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="124.5" y="672.4873">client-api</text><rect fill="#FEFECE" filter="url(#fyn65chsd2y5h)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="152" x="273.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="138" x="280.5" y="70.9951">payment-processor</text><rect fill="#FEFECE" filter="url(#fyn65chsd2y5h)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="152" x="273.5" y="652.4922"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="138" x="280.5" y="672.4873">payment-processor</text><rect fill="#FEFECE" filter="url(#fyn65chsd2y5h)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="44" x="513.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="520.5" y="70.9951">OCS</text><rect fill="#FEFECE" filter="url(#fyn65chsd2y5h)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="44" x="513.5" y="652.4922"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="520.5" y="672.4873">OCS</text><rect fill="#FEFECE" filter="url(#fyn65chsd2y5h)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="46" x="571.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="578.5" y="70.9951">DAO</text><rect fill="#FEFECE" filter="url(#fyn65chsd2y5h)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="46" x="571.5" y="652.4922"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="578.5" y="672.4873">DAO</text><rect fill="#FEFECE" filter="url(#fyn65chsd2y5h)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="56" x="631.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="638.5" y="70.9951">Stripe</text><rect fill="#FEFECE" filter="url(#fyn65chsd2y5h)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="56" x="631.5" y="652.4922"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="638.5" y="672.4873">Stripe</text><rect fill="#FFFFFF" filter="url(#fyn65chsd2y5h)" height="539.1953" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="26.5" y="96.2969"/><rect fill="#FFFFFF" filter="url(#fyn65chsd2y5h)" height="518.0625" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="154.5" y="117.4297"/><rect fill="#FFFFFF" filter="url(#fyn65chsd2y5h)" height="228.0625" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="346.5" y="259.0938"/><rect fill="#FFFFFF" filter="url(#fyn65chsd2y5h)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="532.5" y="428.8906"/><rect fill="#FFFFFF" filter="url(#fyn65chsd2y5h)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="591.5" y="200.8281"/><rect fill="#FFFFFF" filter="url(#fyn65chsd2y5h)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="591.5" y="288.2266"/><rect fill="#FFFFFF" filter="url(#fyn65chsd2y5h)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="591.5" y="577.2266"/><rect fill="#FFFFFF" filter="url(#fyn65chsd2y5h)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="656.5" y="370.625"/><polygon fill="#A80036" points="142.5,113.4297,152.5,117.4297,142.5,121.4297,146.5,117.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="36.5" x2="148.5" y1="117.4297" y2="117.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="43.5" y="112.3638">DELETE /profile</text><path d="M169,130.4297 L169,170.4297 L498,170.4297 L498,140.4297 L488,130.4297 L169,130.4297 " fill="#FBFB77" filter="url(#fyn65chsd2y5h)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M488,130.4297 L488,140.4297 L498,140.4297 L488,130.4297 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="308" x="175" y="147.4966">{name} identifies the user (from Oauth2 auth.)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="289" x="175" y="162.6294">and is equivalent to the users email address</text><polygon fill="#A80036" points="579.5,196.8281,589.5,200.8281,579.5,204.8281,583.5,200.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="164.5" x2="585.5" y1="200.8281" y2="200.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="138" x="171.5" y="195.7622">getPaymentId(name)</text><polygon fill="#A80036" points="175.5,225.9609,165.5,229.9609,175.5,233.9609,171.5,229.9609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="169.5" x2="595.5" y1="229.9609" y2="229.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="181.5" y="224.895">{paymentId}</text><polygon fill="#A80036" points="334.5,255.0938,344.5,259.0938,334.5,263.0938,338.5,259.0938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="164.5" x2="340.5" y1="259.0938" y2="259.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="163" x="171.5" y="254.0278">deleteProfile(paymentId)</text><polygon fill="#A80036" points="579.5,284.2266,589.5,288.2266,579.5,292.2266,583.5,288.2266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="356.5" x2="585.5" y1="288.2266" y2="288.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="214" x="363.5" y="283.1606">getStripeCustomerId(paymentId)</text><polygon fill="#A80036" points="367.5,313.3594,357.5,317.3594,367.5,321.3594,363.5,317.3594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="361.5" x2="595.5" y1="317.3594" y2="317.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="373.5" y="312.2935">{paymentId}</text><path d="M107.5,332.3594 L171.5,332.3594 L171.5,339.3594 L161.5,349.3594 L107.5,349.3594 L107.5,332.3594 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="216.7344" style="stroke: #000000; stroke-width: 2.0;" width="594" x="107.5" y="332.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="122.5" y="345.4263">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="109" x="186.5" y="344.5698">[successful case]</text><polygon fill="#A80036" points="644.5,366.625,654.5,370.625,644.5,374.625,648.5,370.625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="356.5" x2="650.5" y1="370.625" y2="370.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="235" x="363.5" y="365.5591">DELETE /v1/customers {paymentId}</text><polygon fill="#A80036" points="367.5,395.7578,357.5,399.7578,367.5,403.7578,363.5,399.7578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="361.5" x2="660.5" y1="399.7578" y2="399.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="373.5" y="394.6919">{result}</text><polygon fill="#A80036" points="520.5,424.8906,530.5,428.8906,520.5,432.8906,524.5,428.8906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="356.5" x2="526.5" y1="428.8906" y2="428.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="157" x="363.5" y="423.8247">clearBucket(paymentId)</text><polygon fill="#A80036" points="367.5,454.0234,357.5,458.0234,367.5,462.0234,363.5,458.0234" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="361.5" x2="536.5" y1="458.0234" y2="458.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="373.5" y="452.9575">{result}</text><polygon fill="#A80036" points="175.5,483.1563,165.5,487.1563,175.5,491.1563,171.5,487.1563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="169.5" x2="350.5" y1="487.1563" y2="487.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="181.5" y="482.0903">{result}</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="107.5" x2="701.5" y1="496.1563" y2="496.1563"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="40" x="112.5" y="506.3667">[error]</text><path d="M356,514.9609 L356,539.9609 L485,539.9609 L485,524.9609 L475,514.9609 L356,514.9609 " fill="#FBFB77" filter="url(#fyn65chsd2y5h)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M475,514.9609 L475,524.9609 L485,524.9609 L475,514.9609 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="362" y="532.0278">Unroll etc. (TBD)</text><polygon fill="#A80036" points="579.5,573.2266,589.5,577.2266,579.5,581.2266,583.5,577.2266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="164.5" x2="585.5" y1="577.2266" y2="577.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="171.5" y="572.1606">deleteProfile(name)</text><polygon fill="#A80036" points="175.5,602.3594,165.5,606.3594,175.5,610.3594,171.5,606.3594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="169.5" x2="595.5" y1="606.3594" y2="606.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="181.5" y="601.2935">{result}</text><polygon fill="#A80036" points="42.5,631.4922,32.5,635.4922,42.5,639.4922,38.5,635.4922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="36.5" x2="158.5" y1="635.4922" y2="635.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="48.5" y="630.4263">{result}</text><!--
@startuml

actor Client
participant Client

box "Prime"
    participant "client-api"
    participant "payment-processor"
    participant OCS
    participant DAO
end box
participant Stripe

activate Client

    Client -> "client-api": DELETE /profile
    activate "client-api"
    note right of "client-api"
       {name} identifies the user (from Oauth2 auth.)
       and is equivalent to the users email address
    end note

    "client-api" -> DAO : getPaymentId(name)
    activate DAO
    DAO -> "client-api" : {paymentId}
    deactivate DAO

    "client-api" -> "payment-processor" : deleteProfile(paymentId)
    activate "payment-processor"

    "payment-processor" -> DAO : getStripeCustomerId(paymentId)
    activate DAO
    DAO -> "payment-processor" : {paymentId}
    deactivate DAO

    alt successful case
       "payment-processor" -> Stripe : DELETE /v1/customers {paymentId}
       activate Stripe
       "Stripe" -> "payment-processor" : {result}
       deactivate Stripe

        "payment-processor" -> OCS : clearBucket(paymentId)
        activate OCS
        OCS -> "payment-processor" : {result}
        deactivate OCS

       "payment-processor" -> "client-api" : {result}
       deactivate "payment-processor"

    else error
       note right of "payment-processor" : Unroll etc. (TBD)

    end

    "client-api" -> DAO : deleteProfile(name)
    activate DAO
    DAO -> "client-api" : {result}
    deactivate DAO

    "client-api" -> Client : {result}
    deactivate "client-api"

deactivate Client

@enduml

PlantUML version 1.2018.08(Sun Jun 24 14:31:00 CEST 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_171-8u171-b11-0ubuntu0.17.10.1-b11
Operating System: Linux
OS Version: 4.13.0-46-generic
Default Encoding: UTF-8
Language: nb
Country: NO
--></g></svg>