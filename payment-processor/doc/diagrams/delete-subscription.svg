<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="663px" preserveAspectRatio="none" style="width:645px;height:663px;" version="1.1" viewBox="0 0 645 663" width="645px" zoomAndPan="magnify"><defs><filter height="300%" id="f1kfwm71zqmzrz" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#DDDDDD" height="648.3906" style="stroke: #A80036; stroke-width: 1.0;" width="444" x="113.5" y="4"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="43" x="314" y="16.0669">Prime</text><rect fill="#FFFFFF" filter="url(#f1kfwm71zqmzrz)" height="451.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="26.5" y="96.2969"/><rect fill="#FFFFFF" filter="url(#f1kfwm71zqmzrz)" height="430.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="154.5" y="117.4297"/><rect fill="#FFFFFF" filter="url(#f1kfwm71zqmzrz)" height="318.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="313.5" y="200.8281"/><rect fill="#FFFFFF" filter="url(#f1kfwm71zqmzrz)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="523.5" y="229.9609"/><rect fill="#FFFFFF" filter="url(#f1kfwm71zqmzrz)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="523.5" y="370.625"/><rect fill="#FFFFFF" filter="url(#f1kfwm71zqmzrz)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="588.5" y="312.3594"/><rect fill="#FFFFFF" filter="url(#f1kfwm71zqmzrz)" height="187.6016" style="stroke: #000000; stroke-width: 2.0;" width="403" x="230.5" y="274.0938"/><rect fill="#FFFFFF" height="53.9375" style="stroke: none; stroke-width: 1.0;" width="403" x="230.5" y="407.7578"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="31" x2="31" y1="86.2969" y2="566.0938"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="159.5" x2="159.5" y1="86.2969" y2="566.0938"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="318.5" x2="318.5" y1="86.2969" y2="566.0938"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="457.5" x2="457.5" y1="86.2969" y2="566.0938"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="528.5" x2="528.5" y1="86.2969" y2="566.0938"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="593.5" x2="593.5" y1="86.2969" y2="566.0938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="41" x="8" y="82.9951">Client</text><ellipse cx="31.5" cy="13" fill="#FEFECE" filter="url(#f1kfwm71zqmzrz)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M31.5,21 L31.5,48 M18.5,29 L44.5,29 M31.5,48 L18.5,63 M31.5,48 L44.5,63 " fill="none" filter="url(#f1kfwm71zqmzrz)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="41" x="8" y="578.0889">Client</text><ellipse cx="31.5" cy="591.3906" fill="#FEFECE" filter="url(#f1kfwm71zqmzrz)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M31.5,599.3906 L31.5,626.3906 M18.5,607.3906 L44.5,607.3906 M31.5,626.3906 L18.5,641.3906 M31.5,626.3906 L44.5,641.3906 " fill="none" filter="url(#f1kfwm71zqmzrz)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f1kfwm71zqmzrz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="80" x="117.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="124.5" y="70.9951">client-api</text><rect fill="#FEFECE" filter="url(#f1kfwm71zqmzrz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="80" x="117.5" y="565.0938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="124.5" y="585.0889">client-api</text><rect fill="#FEFECE" filter="url(#f1kfwm71zqmzrz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="152" x="240.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="138" x="247.5" y="70.9951">payment-processor</text><rect fill="#FEFECE" filter="url(#f1kfwm71zqmzrz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="152" x="240.5" y="565.0938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="138" x="247.5" y="585.0889">payment-processor</text><rect fill="#FEFECE" filter="url(#f1kfwm71zqmzrz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="44" x="433.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="440.5" y="70.9951">OCS</text><rect fill="#FEFECE" filter="url(#f1kfwm71zqmzrz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="44" x="433.5" y="565.0938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="440.5" y="585.0889">OCS</text><rect fill="#FEFECE" filter="url(#f1kfwm71zqmzrz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="46" x="503.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="510.5" y="70.9951">DAO</text><rect fill="#FEFECE" filter="url(#f1kfwm71zqmzrz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="46" x="503.5" y="565.0938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="510.5" y="585.0889">DAO</text><rect fill="#FEFECE" filter="url(#f1kfwm71zqmzrz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="56" x="563.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="570.5" y="70.9951">Stripe</text><rect fill="#FEFECE" filter="url(#f1kfwm71zqmzrz)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="56" x="563.5" y="565.0938"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="570.5" y="585.0889">Stripe</text><rect fill="#FFFFFF" filter="url(#f1kfwm71zqmzrz)" height="451.7969" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="26.5" y="96.2969"/><rect fill="#FFFFFF" filter="url(#f1kfwm71zqmzrz)" height="430.6641" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="154.5" y="117.4297"/><rect fill="#FFFFFF" filter="url(#f1kfwm71zqmzrz)" height="318.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="313.5" y="200.8281"/><rect fill="#FFFFFF" filter="url(#f1kfwm71zqmzrz)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="523.5" y="229.9609"/><rect fill="#FFFFFF" filter="url(#f1kfwm71zqmzrz)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="523.5" y="370.625"/><rect fill="#FFFFFF" filter="url(#f1kfwm71zqmzrz)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="588.5" y="312.3594"/><polygon fill="#A80036" points="142.5,113.4297,152.5,117.4297,142.5,121.4297,146.5,117.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="36.5" x2="148.5" y1="117.4297" y2="117.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="43.5" y="112.3638">DELETE /profile</text><path d="M169,130.4297 L169,170.4297 L498,170.4297 L498,140.4297 L488,130.4297 L169,130.4297 " fill="#FBFB77" filter="url(#f1kfwm71zqmzrz)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M488,130.4297 L488,140.4297 L498,140.4297 L488,130.4297 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="308" x="175" y="147.4966">{name} identifies the user (from Oauth2 auth.)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="289" x="175" y="162.6294">and is equivalent to the users email address</text><polygon fill="#A80036" points="301.5,196.8281,311.5,200.8281,301.5,204.8281,305.5,200.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="164.5" x2="307.5" y1="200.8281" y2="200.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="171.5" y="195.7622">deleteProfile(name)</text><polygon fill="#A80036" points="511.5,225.9609,521.5,229.9609,511.5,233.9609,515.5,229.9609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="323.5" x2="517.5" y1="229.9609" y2="229.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="330.5" y="224.895">getStripeCustomerId(name)</text><polygon fill="#A80036" points="334.5,255.0938,324.5,259.0938,334.5,263.0938,330.5,259.0938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="328.5" x2="527.5" y1="259.0938" y2="259.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="340.5" y="254.0278">{customerId}</text><path d="M230.5,274.0938 L294.5,274.0938 L294.5,281.0938 L284.5,291.0938 L230.5,291.0938 L230.5,274.0938 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="187.6016" style="stroke: #000000; stroke-width: 2.0;" width="403" x="230.5" y="274.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="245.5" y="287.1606">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="109" x="309.5" y="286.3042">[successful case]</text><polygon fill="#A80036" points="576.5,308.3594,586.5,312.3594,576.5,316.3594,580.5,312.3594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="323.5" x2="582.5" y1="312.3594" y2="312.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="238" x="330.5" y="307.2935">DELETE /v1/customers {customerId}</text><polygon fill="#A80036" points="334.5,337.4922,324.5,341.4922,334.5,345.4922,330.5,341.4922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="328.5" x2="592.5" y1="341.4922" y2="341.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="340.5" y="336.4263">{result}</text><polygon fill="#A80036" points="511.5,366.625,521.5,370.625,511.5,374.625,515.5,370.625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="323.5" x2="517.5" y1="370.625" y2="370.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="130" x="330.5" y="365.5591">deleteProfile(name)</text><polygon fill="#A80036" points="334.5,395.7578,324.5,399.7578,334.5,403.7578,330.5,399.7578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="328.5" x2="527.5" y1="399.7578" y2="399.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="340.5" y="394.6919">{result}</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="230.5" x2="633.5" y1="408.7578" y2="408.7578"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="40" x="235.5" y="418.9683">[error]</text><path d="M328,427.5625 L328,452.5625 L457,452.5625 L457,437.5625 L447,427.5625 L328,427.5625 " fill="#FBFB77" filter="url(#f1kfwm71zqmzrz)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M447,427.5625 L447,437.5625 L457,437.5625 L447,427.5625 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="334" y="444.6294">Unroll etc. (TBD)</text><polygon fill="#A80036" points="445.5,485.8281,455.5,489.8281,445.5,493.8281,449.5,489.8281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="323.5" x2="451.5" y1="489.8281" y2="489.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="110" x="330.5" y="484.7622">Clear bucket etc.</text><polygon fill="#A80036" points="175.5,514.9609,165.5,518.9609,175.5,522.9609,171.5,518.9609" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="169.5" x2="317.5" y1="518.9609" y2="518.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="181.5" y="513.895">{result}</text><polygon fill="#A80036" points="42.5,544.0938,32.5,548.0938,42.5,552.0938,38.5,548.0938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="36.5" x2="158.5" y1="548.0938" y2="548.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="48.5" y="543.0278">{result}</text><!--
@startuml

actor Client
participant Client

box "Prime"
    participant "client-api"
    participant "payment-processor"
    participant OCS
    participant DAO
end box
participant Stripe

activate Client

    Client -> "client-api": DELETE /profile
    activate "client-api"
    note right of "client-api"
       {name} identifies the user (from Oauth2 auth.)
       and is equivalent to the users email address
    end note

    "client-api" -> "payment-processor" : deleteProfile(name)
    activate "payment-processor"

    "payment-processor" -> DAO : getStripeCustomerId(name)
    activate DAO
    DAO -> "payment-processor" : {customerId}
    deactivate DAO

    alt successful case
       "payment-processor" -> Stripe : DELETE /v1/customers {customerId}
       activate Stripe
       "Stripe" -> "payment-processor" : {result}
       deactivate Stripe

       "payment-processor" -> DAO : deleteProfile(name)
       activate DAO
       DAO -> "payment-processor" : {result}
       deactivate DAO

    else error
       note right of "payment-processor" : Unroll etc. (TBD)

    end

    "payment-processor" -> OCS : Clear bucket etc.

    "payment-processor" -> "client-api" : {result}
    deactivate "payment-processor"

    "client-api" -> Client : {result}
    deactivate "client-api"

deactivate Client

@enduml

PlantUML version 1.2018.08(Sun Jun 24 14:31:00 CEST 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_171-8u171-b11-0ubuntu0.17.10.1-b11
Operating System: Linux
OS Version: 4.13.0-46-generic
Default Encoding: UTF-8
Language: nb
Country: NO
--></g></svg>