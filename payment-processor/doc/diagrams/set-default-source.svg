<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="500px" preserveAspectRatio="none" style="width:600px;height:500px;" version="1.1" viewBox="0 0 600 500" width="600px" zoomAndPan="magnify"><defs><filter height="300%" id="f1jjj6z1pr7jyh" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#DDDDDD" height="485.9219" style="stroke: #A80036; stroke-width: 1.0;" width="354" x="173.5" y="4"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="43" x="329" y="16.0669">Prime</text><rect fill="#FFFFFF" filter="url(#f1jjj6z1pr7jyh)" height="289.3281" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="26.5" y="96.2969"/><rect fill="#FFFFFF" filter="url(#f1jjj6z1pr7jyh)" height="34.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="214.5" y="117.4297"/><rect fill="#FFFFFF" filter="url(#f1jjj6z1pr7jyh)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="493.5" y="269.0938"/><rect fill="#FFFFFF" filter="url(#f1jjj6z1pr7jyh)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="493.5" y="327.3594"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="31" x2="31" y1="86.2969" y2="403.625"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="219.5" x2="219.5" y1="86.2969" y2="403.625"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="349.5" x2="349.5" y1="86.2969" y2="403.625"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="498.5" x2="498.5" y1="86.2969" y2="403.625"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="563.5" x2="563.5" y1="86.2969" y2="403.625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="41" x="8" y="82.9951">Client</text><ellipse cx="31.5" cy="13" fill="#FEFECE" filter="url(#f1jjj6z1pr7jyh)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M31.5,21 L31.5,48 M18.5,29 L44.5,29 M31.5,48 L18.5,63 M31.5,48 L44.5,63 " fill="none" filter="url(#f1jjj6z1pr7jyh)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="41" x="8" y="415.6201">Client</text><ellipse cx="31.5" cy="428.9219" fill="#FEFECE" filter="url(#f1jjj6z1pr7jyh)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M31.5,436.9219 L31.5,463.9219 M18.5,444.9219 L44.5,444.9219 M31.5,463.9219 L18.5,478.9219 M31.5,463.9219 L44.5,478.9219 " fill="none" filter="url(#f1jjj6z1pr7jyh)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#f1jjj6z1pr7jyh)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="80" x="177.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="184.5" y="70.9951">client-api</text><rect fill="#FEFECE" filter="url(#f1jjj6z1pr7jyh)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="80" x="177.5" y="402.625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="184.5" y="422.6201">client-api</text><rect fill="#FEFECE" filter="url(#f1jjj6z1pr7jyh)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="152" x="271.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="138" x="278.5" y="70.9951">payment-processor</text><rect fill="#FEFECE" filter="url(#f1jjj6z1pr7jyh)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="152" x="271.5" y="402.625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="138" x="278.5" y="422.6201">payment-processor</text><rect fill="#FEFECE" filter="url(#f1jjj6z1pr7jyh)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="46" x="473.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="480.5" y="70.9951">DAO</text><rect fill="#FEFECE" filter="url(#f1jjj6z1pr7jyh)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="46" x="473.5" y="402.625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="480.5" y="422.6201">DAO</text><rect fill="#FEFECE" filter="url(#f1jjj6z1pr7jyh)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="56" x="533.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="540.5" y="70.9951">Stripe</text><rect fill="#FEFECE" filter="url(#f1jjj6z1pr7jyh)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="56" x="533.5" y="402.625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="540.5" y="422.6201">Stripe</text><rect fill="#FFFFFF" filter="url(#f1jjj6z1pr7jyh)" height="289.3281" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="26.5" y="96.2969"/><rect fill="#FFFFFF" filter="url(#f1jjj6z1pr7jyh)" height="34.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="214.5" y="117.4297"/><rect fill="#FFFFFF" filter="url(#f1jjj6z1pr7jyh)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="493.5" y="269.0938"/><rect fill="#FFFFFF" filter="url(#f1jjj6z1pr7jyh)" height="29.1328" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="493.5" y="327.3594"/><polygon fill="#A80036" points="202.5,113.4297,212.5,117.4297,202.5,121.4297,206.5,117.4297" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="36.5" x2="208.5" y1="117.4297" y2="117.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="43.5" y="112.3638">Get saved sources</text><polygon fill="#A80036" points="47.5,147.5625,37.5,151.5625,47.5,155.5625,43.5,151.5625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="41.5" x2="218.5" y1="151.5625" y2="151.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="53.5" y="146.4966">{list of sources}</text><path d="M229,130.4297 L229,155.4297 L455,155.4297 L455,140.4297 L445,130.4297 L229,130.4297 " fill="#FBFB77" filter="url(#f1jjj6z1pr7jyh)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M445,130.4297 L445,140.4297 L455,140.4297 L445,130.4297 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="205" x="235" y="147.4966">See "list-sources" flow diagram</text><polygon fill="#A80036" points="207.5,181.6953,217.5,185.6953,207.5,189.6953,211.5,185.6953" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="36.5" x2="213.5" y1="185.6953" y2="185.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="43.5" y="180.6294">PUT /sources {sourceId}</text><path d="M224,198.6953 L224,238.6953 L553,238.6953 L553,208.6953 L543,198.6953 L224,198.6953 " fill="#FBFB77" filter="url(#f1jjj6z1pr7jyh)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M543,198.6953 L543,208.6953 L553,208.6953 L543,198.6953 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="308" x="230" y="215.7622">{name} identifies the user (from Oauth2 auth.)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="289" x="230" y="230.895">and is equivalent to the users email address</text><polygon fill="#A80036" points="481.5,265.0938,491.5,269.0938,481.5,273.0938,485.5,269.0938" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="219.5" x2="487.5" y1="269.0938" y2="269.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="138" x="226.5" y="264.0278">getPaymentId(name)</text><polygon fill="#A80036" points="230.5,294.2266,220.5,298.2266,230.5,302.2266,226.5,298.2266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="224.5" x2="497.5" y1="298.2266" y2="298.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="86" x="236.5" y="293.1606">{paymentId}</text><polygon fill="#A80036" points="481.5,323.3594,491.5,327.3594,481.5,331.3594,485.5,327.3594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="219.5" x2="487.5" y1="327.3594" y2="327.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="255" x="226.5" y="322.2935">setDefaultSource(paymentId, sourceId)</text><polygon fill="#A80036" points="230.5,352.4922,220.5,356.4922,230.5,360.4922,226.5,356.4922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="224.5" x2="497.5" y1="356.4922" y2="356.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="236.5" y="351.4263">{result}</text><polygon fill="#A80036" points="42.5,381.625,32.5,385.625,42.5,389.625,38.5,385.625" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="36.5" x2="218.5" y1="385.625" y2="385.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="48.5" y="380.5591">{result}</text><!--
@startuml

actor Client
participant Client

box "Prime"
    participant "client-api"
    participant "payment-processor"
    participant "DAO"
end box
participant Stripe

activate Client

    Client -> "client-api" : Get saved sources
    activate "client-api"
    "client-api" -> Client : {list of sources}
    deactivate "client-api"
    note right : See "list-sources" flow diagram

    Client -> "client-api" : PUT /sources {sourceId}
    note right of "client-api"
       {name} identifies the user (from Oauth2 auth.)
       and is equivalent to the users email address
    end note

    "client-api" -> DAO : getPaymentId(name)
    activate DAO
    DAO -> "client-api" : {paymentId}
    deactivate DAO

    "client-api" -> DAO : setDefaultSource(paymentId, sourceId)
    activate DAO
    DAO -> "client-api" : {result}
    deactivate DAO

    "client-api" -> Client : {result}
    deactivate "client-api"

deactivate Client

@enduml

PlantUML version 1.2018.08(Sun Jun 24 14:31:00 CEST 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 1.8.0_171-8u171-b11-0ubuntu0.17.10.1-b11
Operating System: Linux
OS Version: 4.13.0-46-generic
Default Encoding: UTF-8
Language: nb
Country: NO
--></g></svg>