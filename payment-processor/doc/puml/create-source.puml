@startuml

actor Client
participant Client

box "Prime"
    participant "client-api"
    participant "payment-processor"
    participant OCS
    participant DAO
end box
participant Stripe

activate Client
    Client -> Client : Collecting payment information

    Client -> Stripe : Create new source with Stripe
    activate Stripe
    Stripe -> Client : {sourceId}
    deactivate Stripe

    Client -> "client-api" : POST /sources {sourceId}

    "client-api" -> "payment-processor" : addSource(name, sourceId)

    "payment-processor" -> DAO : getStripeCustomerId(name)
    activate DAO
    DAO -> "payment-processor" : {customerId}
    deactivate DAO

    "payment-processor" -> Stripe : POST /v1/customers/{customerId}/sources {sourceId}
    activate Stripe
    Stripe -> "payment-processor" : {sourceInfo}
    deactivate Stripe

    "payment-processor" -> "client-api" : {result}
    deactivate "payment-processor"

    "client-api" -> Client : {result}
    deactivate "client-api"

deactivate Client

@enduml
